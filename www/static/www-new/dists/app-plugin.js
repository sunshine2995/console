webpackJsonp([10],{190:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function updateConfigGroup($dom){for(var config_group=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0;i<config_group.length;i++){for(var item=config_group[i],config=item.config||[],$groupItem=$dom.find(".plugin_group_item_tpl").eq(i),j=0;j<config.length;j++){var currConfig=config[j];if(currConfig.is_change){var $currConfig=$groupItem.find(".form-group");if("string"===currConfig.attr_type&&(currConfig.attr_value=$currConfig.find("[name="+currConfig.attr_name+"]").val()),"radio"===currConfig.attr_type&&(currConfig.attr_value=$currConfig.find("[name="+currConfig.attr_name+"]").val()),"checkbox"===currConfig.attr_type){var val=[];$currConfig.find("[name="+currConfig.attr_name+"] option").each(function(index,item){item.selected&&val.push(item.value)}),currConfig.attr_value=val.join(",")}}}item.config=config}}Object.defineProperty(exports,"__esModule",{value:!0});var _pageController=__webpack_require__(17),_pageController2=_interopRequireDefault(_pageController),_appApiCenter=__webpack_require__(10),_pluginApiCenter=(__webpack_require__(20),__webpack_require__(504)),_widget=__webpack_require__(4),_widget2=_interopRequireDefault(_widget),artTemplate=__webpack_require__(107),Msg=_widget2.default.Message,typeMap={downstream_port:"下游应用端口",upstream_port:"应用端口",un_define:"不依赖"},injectTypeMap={env:"环境变量",auto:"主动发现"};_widget2.default.define("plugin_group_item_fields",{_defaultOption:{tpl:'<form class="plugin_group_item_fields form-horizontal"></form>',attrs:[]},_init:function(option){this.callParent(option),"plugin_group_item_fields"===this.ClassName&&this._create()},_create:function(){this.callParent();for(var element=this.getElement(),html=[],i=0;i<this.option.attrs.length;i++){var item=this.option.attrs[i];switch(html.push('<div class="form-group" overflow:hidden; style="overflow:hidden;">'),html.push('<label title="'+item.attr_name+'" class="form-label ws-nowrap">'+item.attr_name+": </label>"),html.push('<div class="form-input fn-tips"  data-toggle="tooltip" data-placement="top" title="'+(item.attr_info||"")+'">'),item.attr_type){case"string":html.push('<input name="'+item.attr_name+'" class="form-control input-sm" value="'+(item.attr_value||item.attr_default_value||"")+'"  type="text" '+(item.is_change?"":"disabled=disabled")+" />");break;case"radio":html.push('<select class="form-control" '+(item.is_change?"":"disabled=disabled")+' name="'+item.attr_name+'">');for(var alt_value=item.attr_alt_value.split(","),j=0;j<alt_value.length;j++){var val=alt_value[j],checked=!1;item.attr_value?item.attr_value===val&&(checked=!0):item.attr_default_value===val&&(checked=!0),html.push('<option value="'+val+'" '+(checked?"selected=selected":"")+" >"+val+"</option>")}html.push("</select>");break;case"checkbox":html.push('<select multiple="multiple" class="form-control" '+(item.is_change?"":"disabled=disabled")+' name="'+item.attr_name+'">');for(var alt_value=item.attr_alt_value.split(","),j=0;j<alt_value.length;j++){var val=alt_value[j],checked=!1;if(item.attr_value){var itemValue=item.attr_value.split(",");itemValue.indexOf(val)>-1&&(checked=!0)}else if(item.attr_default_value){var itemValue=item.attr_value.split(",");itemValue.indexOf(val)>-1&&(checked=!0)}html.push('<option value="'+val+'" '+(checked?"selected=selected":"")+" >"+val+"</option>")}html.push("</select>")}html.push("</div>"),html.push("</div>")}element.html(html.join(""))}}),_widget2.default.define("plugin_group_downstream_port",{_defaultOption:{tpl:'<dl class="plugin_group_item_tpl"><dt class="table table-bordered"><span class="item-label">下游应用: <span class="target_service"></span></span><span class="item-label">端口号: <span class="port"></span></span><span class="item-label">端口协议: <span class="protocol"></span></span><dt><dd class="fields"></dd></dl>',config:{}},_init:function(option){this.callParent(option),"plugin_group_downstream_port"==this.ClassName&&(this._create(),this.bind())},_create:function(){this.callParent();var element=this.getElement();element.find(".type").html(typeMap[this.option.config.service_meta_type]),element.find(".target_service").html(this.option.config.dest_service_cname),element.find(".port").html(this.option.config.port),element.find(".protocol").html(this.option.config.protocol),element.find(".fields").html(_widget2.default.create("plugin_group_item_fields",{attrs:this.option.config.config}).getElement())},bind:function(){}}),_widget2.default.define("plugin_group_upstream_port",{_defaultOption:{tpl:'<dl class="plugin_group_item_tpl"><dt><span class="item-label">端口号: <span class="port"></span></span><span class="item-label">端口协议: <span class="protocol"></span></span><dt><dd  class="fields"></dd></dl>',config:{}},_init:function(option){this.callParent(option),"plugin_group_upstream_port"==this.ClassName&&(this._create(),this.bind())},_create:function(){this.callParent();var element=this.getElement();element.find(".type").html(typeMap[this.option.config.service_meta_type]),element.find(".port").html(this.option.config.port),element.find(".protocol").html(this.option.config.protocol),element.find(".fields").html(_widget2.default.create("plugin_group_item_fields",{attrs:this.option.config.config}).getElement())},bind:function(){}}),_widget2.default.define("plugin_group_un_define",{_defaultOption:{tpl:'<dl class="plugin_group_item_tpl"><dt><span class="item-label">注入方式: <span class="type"></span></span><dt><dd class="fields"></dd></dl>',config:{}},_init:function(option){this.callParent(option),"plugin_group_un_define"==this.ClassName&&(this._create(),this.bind())},_create:function(){this.callParent();var element=this.getElement();element.find(".type").html(injectTypeMap[this.option.config.injection]),element.find(".fields").html(_widget2.default.create("plugin_group_item_fields",{attrs:this.option.config.config}).getElement())},bind:function(){}}),_widget2.default.define("plugin_group",{_defaultOption:{tpl:'<div class="plugin_group_tpl"></div>',pluginId:"",config_group:[]},_init:function(option){this.callParent(option),"plugin_group"==this.ClassName&&(this._create(),this.bind())},_create:function(){this.callParent();for(var element=this.getElement(),i=0;i<this.option.config_group.length;i++){var item=this.option.config_group[i],ele=_widget2.default.create("plugin_group_"+item.service_meta_type,{config:item}).getElement();element.append(ele)}},bind:function(){}});var AppPlugin=(0,_pageController2.default)({property:{tenantName:"",serviceAlias:"",serviceId:"",socket:null,instanceId:"",status:"start",isAppLogOutput:!1,renderData:{appInfo:{},pageData:{relations:[],un_relations:[]}}},method:{getInitData:function(){var self=this;return(0,_appApiCenter.getNotInstalledPlugin)(this.tenantName,this.serviceAlias).done(function(data){self.renderData.pageData=data,self.renderData.pageData.relations.length||self.renderData.pageData.un_relations.length?($("#plugin-list-empty").hide(),self.renderRelationPlugin(),self.renderUnrelationPlugin()):$("#plugin-list-empty").show()})},renderRelationPlugin:function(){$("#relation-plugin").html("");for(var relations=this.renderData.pageData.relations||[],html=[],i=0;i<relations.length;i++)html.push(artTemplate.compile($("#relation-plugin-tpl").html())(relations[i]));$("#relation-plugin").html(html.join(""))},renderUnrelationPlugin:function(){$("#unrelation-plugin").html("");for(var un_relations=this.renderData.pageData.un_relations||[],html=[],i=0;i<un_relations.length;i++)html.push(artTemplate.compile($("#unrelation-plugin-tpl").html())(un_relations[i]));$("#unrelation-plugin").html(html.join(""))},installPlugin:function(pluginId,version){var _this=this;(0,_pluginApiCenter.installPlugin)(this.renderData.tenantName,this.renderData.serviceAlias,pluginId,version).done(function(data){_this.getInitData(),Msg.success("安装成功")})},getRelationPluginFromPageData:function(pluginId){var plugins=this.renderData.pageData.relations||[];if(plugins.length)for(var i=0;i<plugins.length;i++)if(plugins[i].plugin_id===pluginId)return plugins[i];return null},getUnRelationPluginFromPageData:function(pluginId){var plugins=this.renderData.pageData.un_relations||[];if(plugins.length)for(var i=0;i<plugins.length;i++)if(plugins[i].plugin_id===pluginId)return plugins[i];return null},getRelationPluginConfigInfo:function(pluginId,version){var plugin=this.getRelationPluginFromPageData(pluginId);plugin&&(0,_pluginApiCenter.getInstalledPluginConfig)(this.renderData.tenantName,this.renderData.serviceAlias,pluginId,version).done(function(data){var $dom=$("[data-plugin-id="+pluginId+"]");data.bean&&($dom.find(".plugin_version").html(version),$dom.find(".plugin_version_info").html(data.bean.build_info),$dom.find(".plugin_version_memory").html(data.bean.memory||0),$dom.find(".plugin_create_time").html((data.bean.create_time||"").split("T").join(" "))),data.list&&data.list.length?(plugin.config_group=data.list,$dom.find(".update-config").show(),$dom.find(".config-body").html(_widget2.default.create("plugin_group",{plugin_id:pluginId,config_group:data.list}).getElement()),$(".fn-tips").tooltip()):$dom.find(".update-config").hide()})},uninstallPlugin:function(pluginId){var _this2=this;(0,_pluginApiCenter.unInstallPlugin)(this.renderData.pageData.tenantName,this.renderData.pageData.serviceAlias,pluginId).done(function(data){_this2.getInitData(),Msg.success("卸载成功")})},disablePlugin:function(pluginId){return(0,_pluginApiCenter.disablePlugin)(this.renderData.pageData.tenantName,this.renderData.pageData.serviceAlias,pluginId)},activePlugin:function(pluginId){return(0,_pluginApiCenter.activePlugin)(this.renderData.pageData.tenantName,this.renderData.pageData.serviceAlias,pluginId)},updatepluginVal:function(data){data=JSON.stringify(data),(0,_pluginApiCenter.updatePluginVal)(this.renderData.pageData.tenantName,this.renderData.pageData.serviceAlias,data).done(function(data){Msg.success("修改成功")})},getConfigDatafromDom:function(pluginId){var $dom=$(".relation-plugin[data-plugin-id="+pluginId+"]"),pluginData=this.getRelationPluginFromPageData(pluginId),data={};return $dom.length&&pluginData&&(data.plugin_id=pluginData.plugin_id,data.service_id=this.serviceId,data.config_group=pluginData.config_group,updateConfigGroup($dom,data.config_group)),data},handleUpdateToNew:function(pluginId){return(0,_pluginApiCenter.updatePluginToNew)(this.renderData.pageData.tenantName,this.renderData.pageData.serviceAlias,pluginId).done(function(){Msg.success("更新成功")})}},domEvents:{".install-plugin click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".unrelation-plugin"),pluginId=$parent.attr("data-plugin-id"),version=$parent.attr("data-plugin-version");this.installPlugin(pluginId,version)},".to-open click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id"),version=$parent.attr("data-plugin-version");this.getRelationPluginConfigInfo(pluginId,version),$parent.attr("data-status","opened")},".to-close click":function(e){$(e.currentTarget).parents(".relation-plugin").attr("data-status","closed")},".uninstall click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id");this.uninstallPlugin(pluginId)},".disablePlugin click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id");this.disablePlugin(pluginId).done(function(){$parent.find(".activePlugin").show(),$parent.find(".disablePlugin").hide()})},".activePlugin click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id");this.activePlugin(pluginId).done(function(){$parent.find(".activePlugin").hide(),$parent.find(".disablePlugin").show()})},".update-config click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id"),data=($parent.attr("data-plugin-version"),this.getConfigDatafromDom(pluginId));this.updatepluginVal(data)},".js-update-field click":function(e){var $target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id"),configIndex=($parent.attr("data-plugin-version"),$target.parents(".form-group").index()),groupIndex=$target.parents(".plugin_group_item_tpl").index(),data=this.getConfigDatafromDom(pluginId),sendData=$.extend(!0,{},data);sendData.config_group=sendData.config_group[groupIndex],sendData.config_group.config=sendData.config_group.config[configIndex],this.updatepluginVal(sendData)},".to-create click":function(e){location.href="/plugins/"+this.renderData.tenantName+"/create/"},".update-to-newversion click":function(e){var _this3=this,$target=$(e.currentTarget),$parent=$target.parents(".relation-plugin"),pluginId=$parent.attr("data-plugin-id");this.handleUpdateToNew(pluginId).done(function(){$parent.find(".update-to-newversion").hide(),_this3.getRelationPluginConfigInfo(pluginId,data.bean.build_version.build_version),$parent.attr("data-plugin-version",data.bean.build_version.build_version);var plugin=_this3.getRelationPluginFromPageData(pluginId);plugin&&(plugin.version_info.build_version=data.bean.build_version.build_version)})}},onReady:function(){this.renderData.tenantName=this.tenantName,this.renderData.serviceAlias=this.serviceAlias,this.getInitData().done(function(){})}});window.AppLogController=AppPlugin,exports.default=AppPlugin},504:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getInstalledPluginConfig=exports.updatePluginVal=exports.activePlugin=exports.disablePlugin=exports.unInstallPlugin=exports.updatePluginToNew=exports.installPlugin=void 0;var _http=__webpack_require__(24),_http2=_interopRequireDefault(_http),_util=__webpack_require__(25),_widget=(_interopRequireDefault(_util),__webpack_require__(4)),_widget2=_interopRequireDefault(_widget),_lang=__webpack_require__(48);_interopRequireDefault(_lang),_widget2.default.Message,exports.installPlugin=function(tenantName,serviceAlias,plugin_id,version){var dfd=$.Deferred();return(0,_http2.default)({type:"post",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/relation",data:{plugin_id:plugin_id,build_version:version}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.updatePluginToNew=function(tenantName,serviceAlias,plugin_id){var dfd=$.Deferred();return(0,_http2.default)({type:"put",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/relation",data:{plugin_id:plugin_id,build_version:"use_newest"}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.unInstallPlugin=function(tenantName,serviceAlias,plugin_id){var dfd=$.Deferred();return(0,_http2.default)({type:"delete",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/relation",data:{plugin_id:plugin_id}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.disablePlugin=function(tenantName,serviceAlias,plugin_id){var dfd=$.Deferred();return(0,_http2.default)({type:"put",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/is_switch",data:{plugin_id:plugin_id,is_switch:!1}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.activePlugin=function(tenantName,serviceAlias,plugin_id){var dfd=$.Deferred();return(0,_http2.default)({type:"put",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/is_switch",data:{plugin_id:plugin_id,is_switch:!0}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.updatePluginVal=function(tenantName,serviceAlias){var data=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},dfd=$.Deferred();return(0,_http2.default)({type:"put",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/attrs",data:data}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd},exports.getInstalledPluginConfig=function(tenantName,serviceAlias,plugin_id,version){var dfd=$.Deferred();return(0,_http2.default)({type:"get",url:"/ajax/"+tenantName+"/"+serviceAlias+"/plugin/relation",data:{plugin_id:plugin_id,build_version:version}}).done(function(data){dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd}},535:function(module,exports,__webpack_require__){module.exports=__webpack_require__(190)}},[535]);