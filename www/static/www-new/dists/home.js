webpackJsonp([6],{195:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_pageController=__webpack_require__(17),_pageController2=_interopRequireDefault(_pageController),_apiCenter=__webpack_require__(20),_util=__webpack_require__(25),_util2=_interopRequireDefault(_util),_pageAppApiCenter=__webpack_require__(19),_tenantApiCenter=__webpack_require__(505),template=__webpack_require__(210),NewsScroll=function(){function NewsScroll(props){_classCallCheck(this,NewsScroll),this.timer=null,this.index=0,this.size=0,this.maxItemHeight=0,this.minItemHeight=40,this.isHover=!1,this.isOpen=!1,this.$newsWrap=$(".news"),this.$newsList=$(".news-list"),this.$newsItem=this.$newsWrap.find(".news-item"),this.init()}return _createClass(NewsScroll,[{key:"init",value:function(){this.initStatus(),this.initDom(),this.bindEvent(),this.size>1&&(this.setOpen(!1),this.play())}},{key:"initDom",value:function(){this.$newsList.css({position:"absolute",top:0,visibility:"visible"}),this.$newsItem.height(this.maxItemHeight),0==this.size&&this.$newsWrap.hide()}},{key:"initStatus",value:function(){var self=this;this.size=this.$newsItem.length,this.$newsItem.each(function(){var itemHeight=$(this).outerHeight();self.maxItemHeight=Math.max(self.maxItemHeight,itemHeight)}),this.maxItemHeight=Math.max(this.maxItemHeight,this.minItemHeight)}},{key:"setOpen",value:function(isOpen){this.isOpen=isOpen,this.index=0,this.$newsList.css({top:0}),isOpen?(this.$newsWrap.height(this.maxItemHeight*this.size),$(".news-down").hide(),$(".news-up").show()):(this.$newsWrap.height(this.maxItemHeight),$(".news-down").show(),$(".news-up").hide())}},{key:"setHover",value:function(isHover){this.isHover=isHover}},{key:"play",value:function(){var self=this;this.timer=setTimeout(function(){self.next(),self.doAnimate()},5e3)}},{key:"doAnimate",value:function(){var self=this;this.$newsList.animate({top:-this.index*this.maxItemHeight},"fast",function(){self.isOpen||self.isHover||self.play()})}},{key:"next",value:function(){++this.index>=this.size&&(this.index=0)}},{key:"stop",value:function(){clearTimeout(this.timer)}},{key:"bindEvent",value:function(){var self=this;this.$newsWrap.bind("mouseenter",function(e){self.setHover(!0),self.stop()}).bind("mouseleave",function(e){self.setHover(!1),self.isOpen||self.play()}),this.$newsWrap.find(".news-down").bind("click",function(e){self.stop(),self.setOpen(!0)}),this.$newsWrap.find(".news-up").bind("click",function(e){self.setOpen(!1)})}}]),NewsScroll}(),Home=(0,_pageController2.default)({template:template,property:{tenantName:"",checkInterval:3e3,renderData:{pageData:{},apps:{}}},method:{getInitData:function(){var _this=this;return $.when((0,_pageAppApiCenter.getPageHomeData)(this.tenantName),(0,_tenantApiCenter.getAllApp)(this.tenantName)).done(function(pageData,apps){_this.renderData.pageData=pageData,_this.renderData.apps=apps||[],_this.render()})},checkAppsInfo:function(){var _this2=this;(0,_apiCenter.getTenantAllAppsStatusAndMemory)(this.tenantName).done(function(data){_this2.updateAppsInfo(data)}).always(function(){setTimeout(function(){_this2.checkAppsInfo()},_this2.checkInterval)})},updateAppsInfo:function(result){for(var list=result.list,totalMemory=result.totalMemory,i=0,len=list.length;i<len;i++){var app=list[i],statusMap=_util2.default.getStatusMap(app.status);$("#service_status_"+app.id).find("span").html(app.statusCN),$("#service_status_"+app.id).find("span").attr("class",statusMap.bgClass+" pading5"),$("#service_memory_"+app.id).html(app.runtime_memory+"M")}$("#service_total_memory").html(totalMemory+"M")},handleSearch:function(){var value=$.trim(this.$wrap.find("#search-key").val())||"",$rows=this.$wrap.find(".app-table-row");value?$rows.each(function(){($(this).attr("data-name")||"").indexOf(value)>-1?$(this).show():$(this).hide()}):$rows.show()},getAnnounceMentShow:function(){(0,_apiCenter.getAnnouncement)(this.tenantName).done(function(data){for(var datalist=data.announcements,dataStr="",i=0;i<datalist.length;i++)""==datalist[i].a_tag_url?dataStr+='<div class="alert alert-info">'+datalist[i].content+"</div>":dataStr+='<div class="alert alert-info"><a href="'+datalist[i].a_tag_url+'" target="_blank">'+datalist[i].content+"。请点击查看详情！</a></div>";$("#home-wrap .news").after(dataStr)}).fail(function(data){console.log(data)})}},domEvents:{"#search-app-form submit":function(e){return e.preventDefault(),this.handleSearch(),!1}},onReady:function(){var _this3=this;this.renderData.tenantName=this.tenantName,this.getInitData().done(function(){setTimeout(function(){_this3.getAnnounceMentShow(),_this3.newsScroller=new NewsScroll,_this3.checkAppsInfo()})})}});window.HomeController=Home,exports.default=Home},210:function(module,exports){module.exports='\x3c!-- 公告 start --\x3e\n<div class="alert alert-info news">\n    <span class="glyphicon glyphicon-chevron-down news-icon news-down"></span>\n    <span class="glyphicon glyphicon-chevron-up news-icon news-up"></span>\n    <div class="news-list">\n        <div class="table-row">\n            <div class="news-item">\n                尊敬的用户，您对当前版本的控制台有哪些意见或建议？<a href="http://goodrain123.mikecrm.com/IaIsFX9" target="_blank" style="cursor:pointer;">请点击这里进行反馈。</a>\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- 免费使用阶段 --\x3e\n\x3c!--\n{{ if pageData.pay_type == "free" }}\n<div class="alert alert-info"><a href="/apps/{{tenantName}}/recharge/" target="_blank">现在去充值</a>升级为付费用户，获得更多的资源支持及更好的服务支持。</div>\n{{/if}}\n--\x3e\n\x3c!-- 付费使用阶段 --\x3e\n\x3c!--\n{{ if pageData.pay_type == "payed" &&  pageData.tenant_balance < 20 && pageData.tenant_balance > 0 }}\n<div class="alert alert-warning">您的账户余额偏低，为保证应用的持续稳定运行，<a href="/apps/{{tenantName}}/recharge/" target="_blank">请点击此处充值</a>。</div>\n{{/if}}\n{{if pageData.pay_type == "payed" && pageData.tenant_balance < 0 }}\n<div class="alert alert-danger">您需要<a href="/apps/{{tenantName}}/recharge/" target="_blank">点击此处充值</a>才能重新开启欠费应用。</div>\n{{/if}}\n--\x3e\n\n<div class="flex-box">\n        <div class="flex-singe">\n            <div class="chunkbox">\n            <p class="top">内存</p>\n            <p class="mid mainbg01"></p>\n            <p class="bot" id="service_total_memory">-</p>\n        </div>\n        </div>\n        <div class="flex-singe">\n        <div class="chunkbox">\n            <p class="top">{{pageData.tenant_balance > -1 ? \'余额\' : \'已欠费\'}}</p>\n            <p class="mainbg02 mid"></p>\n            <p class="bot">{{pageData.tenant_balance}}元</p>\n        </div>\n        </div>\n        <div class="flex-singe">\n            <div class="chunkbox">\n            <p class="top">应用</p>\n            <p class="mainbg03 mid"></p>\n            <p class="bot">{{pageData.total_app_number}}个</p>\n        </div>\n        </div>\n        <div class="flex-singe">\n        <div class="chunkbox">\n            <p class="top">团队</p>\n            <p class="mainbg04 mid"></p>\n            <p class="bot">{{pageData.totalNum}}人</p>\n        </div>\n        </div>\n</div>\n\x3c!-- --\x3e\n\x3c!-- --\x3e\n<section class="panel panel-default">\n    <div class="panel-heading clearfix">\n        全部应用\n    </div>\n    <div class="panel-body">\n        <form id="search-app-form" class="form-inline" style="text-align: right;margin-bottom: 20px;">\n            <button onclick="window.location.href=\'/apps/{{tenantName}}/service-entrance/\'" class="btn btn-success pull-left" type="button">新建应用</button>\n            <div class="form-group hidden-xs" style="position: relative;">\n                <i class="fa fa-search" style="position: absolute;left:6px;top:10px;"></i>\n                <input type="text" class="form-control" id="search-key" placeholder="请输入应用名称" style="padding-left: 25px;min-width: 200px;">\n            </div>\n            <button type="submit" id="search-app" class="btn btn-success hidden-xs"> 搜索</button>\n        </form>\n        <table id="table" class="table" style="border-top:1px solid #f5f5f5;">\n            <thead>\n                <tr class="active">\n                    <th>名称</th>\n                    <th class="hidden-xs">内存</th>\n                    <th>状态</th>\n                    <th class="hidden-xs">组</th>\n                    <th class="hidden-xs">类型</th>\n                    <th class="hidden-xs">版本</th>\n                    \x3c!--\n                    <th>操作</th>\n                    --\x3e\n                </tr>\n            </thead>\n            <tbody>\n                {{each apps.sorted_service_list || []}}\n                <tr class="app-table-row" data-name="{{$value.service_cname}}">\n                    <td>\n                        <a href="/apps/{{tenantName}}/{{$value.service_alias}}/detail/">{{$value.service_cname}}</a>\t\n                    </td>\n                    <td id="service_memory_{{$value.service_id}}" class="hidden-xs">-</td>\n                    <td id="service_status_{{$value.service_id}}"><span class="pading5">-</span></td>\n                    <td class="hidden-xs">\n                        {{$value.group_name}}\n                    </td>\n                    <td class="hidden-xs">{{$value.service_type}}</td> \n                    <td class="hidden-xs">\n\n                        {{if $value.category == "application" }}\n                            {{$value.deploy_version}}\n                        {{else}}\n                            {{$value.version}}\t\t\t\t\t\n                        {{/if}}\n                    </td>\n                </tr>\n                {{/each}}\n\n                {{each apps.unsorted_service_list || []}}\n                <tr class="app-table-row" data-name="{{$value.service_cname}}">\n                    <td>\n                        <a href="/apps/{{tenantName}}/{{$value.service_alias}}/detail/">{{$value.service_cname}}</a>\n                    </td>\n                    <td id="service_memory_{{$value.service_id}}" class="hidden-xs">-</td>\n                    <td id="service_status_{{$value.service_id}}"><span class="pading5">-</span></td>\n                    <td class="hidden-xs">\n                        {{$value.group_name}}\n                    </td>\n                    <td class="hidden-xs">{{$value.service_type}}</td>\n                    <td class="hidden-xs">\n                        {{if $value.category == "application" }}\n                            {{$value.deploy_version}}\n                        {{else}}\n                            {{$value.version}}\t\t\t\t\t\n                        {{/if}}\n                    </td>\n                </tr>\n                {{/each}}\n            </tbody>\n        </table>\n    </div>\n</section>'},505:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getAllApp(tenantName){var dfd=$.Deferred();return(0,_http2.default)({type:"get",url:"/ajax/"+tenantName+"/apps"}).done(function(data){!1===data.success?(Msg.warning(data.message),dfd.reject(data)):dfd.resolve(data)}).fail(function(data){dfd.reject(data)}),dfd}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAllApp=getAllApp;var _http=__webpack_require__(24),_http2=_interopRequireDefault(_http),_util=__webpack_require__(25),_widget=(_interopRequireDefault(_util),__webpack_require__(4)),_widget2=_interopRequireDefault(_widget),Msg=_widget2.default.Message},540:function(module,exports,__webpack_require__){module.exports=__webpack_require__(195)}},[540]);