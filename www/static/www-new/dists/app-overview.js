webpackJsonp([2],{188:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createLogTmp(data){var html="";try{var arr=data.time.split(".")[0];arr.split("T")[0];html="<p class='clearfix'><span class='log_time'>"+arr.split("T")[1].split("Z")[0].split("+")[0]+"</span><span class='log_msg'> "+data.message+"</span></p>"}catch(e){console.log(e)}return html}function createLogItemTmp(log,data){var html=[];html.push('<li data-event-id="'+log.event_id+'" class="js-event-row">'),html.push('<time class="tl-time">'),html.push("<h4>"+_dateUtil2.default.format(_appActionLogUtil2.default.getActionTime(log),"hh:mm:ss")+"</h4>"),html.push("<p>"+_dateUtil2.default.dateToCN(_appActionLogUtil2.default.getActionTime(log),"yyyy-MM-dd")+"</p>"),html.push("</time>"),html.push('<i class="fa '+_appActionLogUtil2.default.getActionStatusInfo(log).bgColor+' tl-icon"></i>'),html.push('<div class="tl-content">'),html.push('<div class="panel panel-primary">'),html.push('<div class="panel-heading">');var title=_appActionLogUtil2.default.getActionCN(log)+_appActionLogUtil2.default.getActionStatusInfo(log).text;return _appActionLogUtil2.default.isFail(log)&&(title+="("+log.message+")"),title+="@"+_appActionLogUtil2.default.getActionUser(log),html.push("<span>"+title+"</span>"),html.push('<div class="user btns">'),_appActionLogUtil2.default.canRollback(log)&&html.push('<a href="javascript:;" class="callback_version" data-version="'+_appActionLogUtil2.default.getRollbackVersion(log)+'">回滚到此版本</a>'),html.push('<a href="javascript:;" class="ajax_log_new" data-log="'+log.event_id+'">查看详情</a>'),html.push('<a href="javascript:;" class="hide_log">收起</a>'),html.push("</div>"),html.push("</div>"),html.push('<div class="panel-body">'),_appActionLogUtil2.default.isDeploy(log)&&log.code_version&&(html.push('<div class="version-info">'),html.push('<span class="pull-left ws-nowrap" style="width:60%" title="'+(_appActionLogUtil2.default.getCommitLog(log)||"")+'">代码信息：'+_appActionLogUtil2.default.getCommitLog(log)+"</span>"),html.push('<span class="pull-right">#'+_appActionLogUtil2.default.getCodeVersion(log)+" by "+_appActionLogUtil2.default.getCommitUser(log)+"</span>"),html.push("</div>")),html.push('<div class="log">'),html.push('<p class="log_type">'),html.push('<label class="active log-tab-btn" data-log="info">Info日志</label>'),html.push('<label class="log-tab-btn" data-log="debug">Debug日志</label>'),html.push('<label class="log-tab-btn" data-log="error">Error日志</label>'),html.push("</p>"),html.push('<div class="log_content log_'+log.event_id+'"></div>'),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</li>"),html.join("")}function createLogListTmp(logList){if(jQuery.isEmptyObject(logList))return'<p style="text-align: center;font-size: 18px;">暂无记录<span class="span_src"><img src="/static/www/img/appOutline/log_src.png"></span></p>';for(var htmls="",i=0;i<logList.length;i++){htmls+=createLogItemTmp(logList[i])}return htmls}function overViewGetEventId(tenantName,serviceAlias,action){var dfd=$.Deferred();return(0,_apiCenter.getEventId)(tenantName,serviceAlias,action).done(function(data){var event=data.event,currentEventID=event.event_id,arr=event.event_start_time.split("T"),time=(arr[0],arr[1].split(".")[0]),html=[];html.push('<li data-event-id="'+event.event_id+'" class="js-event-row">'),html.push('<time class="tl-time">'),html.push("<h4>"+time+"</h4>"),html.push("<p>今天</p>"),html.push("</time>"),html.push('<i class="fa bg-grey tl-icon"></i>'),html.push('<div class="tl-content">'),html.push('<div class="panel panel-primary">'),html.push('<div class="panel-heading">');var title=type_json[event.event_type]+"中@"+event.user_name;html.push("<span>"+title+"</span>"),html.push('<div class="user btns">'),html.push('<a href="javascript:;" class="ajax_log_new" data-log="'+currentEventID+'">查看详情</a>'),html.push('<a href="javascript:;" class="hide_log">收起</a>'),html.push("</div>"),html.push("</div>"),html.push('<div class="panel-body">'),html.push('<div class="log">'),html.push('<p class="log_type">'),html.push('<label class="active log-tab-btn" data-log="info">Info日志</label>'),html.push('<label class="log-tab-btn" data-log="debug">Debug日志</label>'),html.push('<label class="log-tab-btn" data-log="error">Error日志</label>'),html.push("</p>"),html.push('<div class="log_content log_height2 log_'+event.event_id+'"></div>'),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</li>"),$(html.join("")).prependTo($("#keylog ul")),dfd.resolve(currentEventID)}).fail(function(data){dfd.reject(data)}),dfd}function _getMoreLog(tenantName,serviceAlias,num){return $.ajax({type:"GET",url:"/ajax/"+tenantName+"/"+serviceAlias+"/events?start_index="+num,data:"",cache:!1,beforeSend:function(xhr,settings){var csrftoken=$.cookie("csrftoken");xhr.setRequestHeader("X-CSRFToken",csrftoken)}})}function getInitLog(tenantName,serviceAlias,start_time){return $.ajax({type:"GET",url:"/ajax/"+tenantName+"/"+serviceAlias+"/events",data:{action:"operate",start_time:start_time||_dateUtil2.default.format(new Date,"yyyy-MM-dd hh:mm")},cache:!1,beforeSend:function(xhr,settings){var csrftoken=$.cookie("csrftoken");xhr.setRequestHeader("X-CSRFToken",csrftoken)}})}Object.defineProperty(exports,"__esModule",{value:!0});var _pageController=__webpack_require__(17),_pageController2=_interopRequireDefault(_pageController),_widget=__webpack_require__(4),_widget2=_interopRequireDefault(_widget),_LogSocket=__webpack_require__(516),_LogSocket2=_interopRequireDefault(_LogSocket),_util=__webpack_require__(25),_util2=_interopRequireDefault(_util),_apiCenter=__webpack_require__(20),_appApiCenter=__webpack_require__(10),_pageAppApiCenter=__webpack_require__(19),_appActionLogUtil=__webpack_require__(517),_appActionLogUtil2=_interopRequireDefault(_appActionLogUtil),_dateUtil=__webpack_require__(518),_dateUtil2=_interopRequireDefault(_dateUtil),Msg=_widget2.default.Message,template=__webpack_require__(205),type_json={deploy:"部署",restart:"启动",delete:"删除",stop:"关闭",HorizontalUpgrade:"水平升级",VerticalUpgrade:"垂直升级",callback:"回滚",create:"创建",own_money:"应用欠费关闭",expired:"应用过期关闭","share-ys":"分享到云市","share-yb":"分享到云帮",reboot:"应用重启","git-change":"仓库地址修改",imageUpgrade:"应用更新"};window.AppOverviewController=(0,_pageController2.default)({template:template,property:{isDoing:!1,category:"",serviceId:"",tenantName:"",serviceAlias:"",manageUrl:"",status:"",checkStatusInterval:3e3,openAction:"restart",closeAction:"stop",updateAction:"imageUpgrade",deployAction:"deploy",rollbackAction:"callback",rebootAction:"reboot",webSocketUrl:"",wild_domain:"",http_port_str:"",needPay:0,plugins:[],payStartTime:"",renderData:{appInfo:{},pageData:{}}},method:{getInitData:function(){var _this=this;(0,_appApiCenter.getAppInfo)(this.tenantName,this.serviceAlias).done(function(appInfo){_this.renderData.appInfo=appInfo,(0,_pageAppApiCenter.getPageOverviewAppData)(_this.tenantName,_this.serviceAlias).done(function(pageData){_this.renderData.pageData=pageData,_this.render(),setTimeout(function(){_this.initLog(),_this.checkStatus(),$(".fn-tips").tooltip(),$("#datetimepicker").datetimepicker({format:"YYYY-MM-DD HH:mm",locale:moment.locale("zh-cn")}).on("dp.change",function(ev){_this.initLog(!0)})}),(0,_appApiCenter.getNotInstalledPlugin)(_this.tenantName,_this.serviceAlias).done(function(data){_this.plugins=(data.relations||[]).slice(0,5),_this.renderPlugin(),_this.isInstalledAnalysis()&&($(".installed-new-plugin").show(),$(".uninstall-new-plugin").hide(),_this.loadMonitorData())})})})},renderPlugin:function(){var html=[];if(this.plugins.length){html.push('<ul style="margin-top: 25px" class="installed-plug">');for(var i=0;i<this.plugins.length;i++){var item=this.plugins[i];html.push('<li class="ws-nowrap '+(item.is_switch?"":"disabled")+'"><a href="/apps/'+this.tenantName+"/"+this.serviceAlias+"/detail/?fr=plugin&plugin_id="+item.plugin_id+'" title="'+item.plugin_info.plugin_alias+'">'+item.plugin_info.plugin_alias+"</a></li>")}html.push("</ul>")}else html.push('<div style="margin-top:60px">'),html.push('<div class="tips">'),html.push("<p>尚未安装插件</p>"),html.push('<a href="/apps/'+this.tenantName+"/"+this.serviceAlias+'/detail/?fr=plugin">去安装</a>'),html.push("</div>"),html.push("</div>");$("#plugin-list-wrap").html(html.join(""))},loadMonitorData:function(){var _this2=this;$.when((0,_appApiCenter.getAppRequestTime)({tenantName:this.tenantName,serviceAlias:this.serviceAlias,serviceId:this.serviceId}),(0,_appApiCenter.getAppRequest)({tenantName:this.tenantName,serviceAlias:this.serviceAlias,serviceId:this.serviceId})).done(function(res1,res2){var result1=res1.bean.result,result2=res2.bean.result;if(result1&&result1.length){var res=Number(result1[0].value[1])||0;res>=0?$(".app_requesttime").html(res.toFixed(0)):$(".app_requesttime").html(res.toFixed(1))}if(result2&&result2.length){var res=Number(result2[0].value[1])||0;$(".app_request").html(res.toFixed(0))}setTimeout(function(){_this2.loadMonitorData()},6e3)})},isInstalledAnalysis:function(){for(var i=0;i<this.plugins.length;i++)if("analyst-plugin:perf"===this.plugins[i].plugin_info.category)return!0;return!1},initLog:function(reload){var self=this;getInitLog(this.tenantName,this.serviceAlias,$("#datetimepicker").val()).done(function(msg){reload&&($("#keylog ul").html(""),self.socket&&(self.socket.close(),self.socket=null),$(".load_more_new").hide());var dataObj=msg||{},logList=dataObj.log||[],next_onOff=dataObj.has_next;if($(".load_more_new").attr("data-num",logList.length),next_onOff&&$(".load_more_new").show(),logList){var html=createLogListTmp(logList);$(html).appendTo($("#keylog ul"))}var firstLog=logList[0];if(firstLog&&""==firstLog.final_status){$("#keylog .log_type").eq(0).hide(),$("#keylog .hide_log").eq(0).html("查看详情");$("#keylog .ajax_log_new").eq(0).attr("data-log");self.getAndRenderEventLog(firstLog.event_id).always(function(){self.createLogSocket(firstLog.event_id,firstLog.type)})}})},checkStatus:function(){var self=this;(0,_appApiCenter.getAppDetail)(this.tenantName,this.serviceAlias).done(function(msg){self.setStatus(msg)}).always(function(){setTimeout(function(){self.checkStatus()},self.checkStatusInterval)})},setStatus:function(msg){msg=msg||{},this.onStatusChange(msg),this.status=msg.status},onStatusChange:function(msg){var obj=msg;if("failure"!=obj.status){var lastCostInfo=(obj.service_attach_info,obj.last_hour_consume||{});$(".show_money").html(lastCostInfo.memory*lastCostInfo.node_num||0),$(".show_disk").html(lastCostInfo.disk||0);var disabledAction=obj.disabledAction||[];$.each(disabledAction,function(index,action){$("[action="+action+"]").hide()});var activeAction=obj.activeAction||[];$.each(activeAction,function(index,action){$("[action="+action+"]").show()});var statusMap=_util2.default.getStatusMap(obj.status),statusCN=obj.status_cn;$("#service_status").html(statusCN);var iconUrl=statusMap.iconUrl;$("#service_status-img").attr("src",iconUrl),"running"===obj.status?$("#service_status-img").addClass("roundloading"):$("#service_status-img").removeClass("roundloading")}},publicCloudShow:function(onoff){onoff?($("#MemoryCost").show(),$("#DiskBox").show(),$("#FlowBox").show(),$("#CostBox").show()):($("#MemoryCost").hide(),$("#DiskBox").hide(),$("#FlowBox").hide(),$("#CostBox").hide())},openApp:function(){var self=this;this.isDoing=!0,overViewGetEventId(this.tenantName,this.serviceAlias,this.openAction).done(function(eventId){(0,_appApiCenter.openAppByEventId)(self.serviceId,self.tenantName,self.serviceAlias,eventId).done(function(data){"success"===data.status?self.createLogSocket(eventId,self.openAction):self.isDoing=!1}).fail(function(){self.isDoing=!1})}).fail(function(data){self.isDoing=!1})},closeApp:function(){var self=this;this.isDoing=!0,overViewGetEventId(this.tenantName,this.serviceAlias,this.closeAction).done(function(eventId){(0,_appApiCenter.closeAppByEventId)(self.serviceId,self.tenantName,self.serviceAlias,eventId).done(function(data){"success"===data.status?self.createLogSocket(eventId,self.closeAction):self.isDoing=!1}).fail(function(){self.isDoing=!1})}).fail(function(data){self.isDoing=!1})},deployApp:function(){var self=this;this.isDoing=!0,overViewGetEventId(this.tenantName,this.serviceAlias,this.deployAction).done(function(eventId){(0,_appApiCenter.deployAppByEventId)(self.category,self.tenantName,self.serviceAlias,eventId).done(function(data){"success"===data.status?self.createLogSocket(eventId,self.deployAction):self.isDoing=!1}).fail(function(){self.isDoing=!1})}).fail(function(data){self.isDoing=!1})},NewrebootApp:function(){var self=this;this.isDoing=!0,overViewGetEventId(this.tenantName,this.serviceAlias,this.rebootAction).done(function(eventId){(0,_appApiCenter.NewrebootByEventId)(self.category,self.tenantName,self.serviceAlias,eventId).done(function(data){"success"===data.status?self.createLogSocket(eventId,self.deployAction):self.isDoing=!1}).fail(function(){self.isDoing=!1})}).fail(function(data){self.isDoing=!1})},rollbackApp:function(version){var self=this;this.isDoing=!0,overViewGetEventId(this.tenantName,this.serviceAlias,this.rollbackAction).done(function(eventId){(0,_appApiCenter.rollbackAppByEventId)(self.tenantName,self.serviceAlias,version,eventId).done(function(data){self.createLogSocket(eventId,self.rollbackAction)}).fail(function(){self.isDoing=!1})}).fail(function(data){self.isDoing=!1})},updateApp:function(){var self=this,confirm=_widget2.default.create("confirm",{title:"更新应用",height:"250px",content:"更新应用会对应用进行重新部署，期间应用可能会暂时无法提供服务，确定要更新吗？",event:{onOk:function(){self.isDoing=!0,overViewGetEventId(self.tenantName,self.serviceAlias,self.updateAction).done(function(eventId){(0,_appApiCenter.updateAppByEventId)(self.serviceId,self.tenantName,self.serviceAlias,eventId).done(function(data){$("#service_image_operate").hide(),self.rebootApp(eventId),confirm.destroy()}).fail(function(){self.isDoing=!1})}).fail(function(){self.isDoing=!1,Msg.danger("创建更新操作错误，请重试")})}}})},rebootApp:function(eventId){var self=this;(0,_appApiCenter.rebootAppByEventId)(self.serviceId,self.tenantName,self.serviceAlias,eventId).done(function(){self.createLogSocket(eventId,self.rebootAction)}).fail(function(){self.isDoing=!1})},createLogSocket:function(eventId,action){var self=this;$("#keylog .panel-heading").eq(0).css({"padding-bottom":"5px"}),$("#keylog .log").eq(0).css({height:"20px"}),$("#keylog .ajax_log_new").eq(0).hide(),$("#keylog .hide_log").eq(0).show(),$("#keylog .log_type").eq(0).hide(),this.socket=new _LogSocket2.default({url:this.webSocketUrl,eventId:eventId,onMessage:function(data){var msgHtml=createLogTmp(data);$(msgHtml).prependTo($("#keylog .log_content").eq(0))},onClose:function(){self.isDoing=!1,$("#keylog li").eq(0).find(".log").removeClass("log_height").css({height:"0px"})},onSuccess:function(data){var str=type_json[action]+"成功";$("#keylog li").eq(0).find(".fa").removeClass("bg-grey").addClass("bg-success"),$("#keylog .panel").eq(0).find(".panel-heading span").html(str)},onFail:function(data){$("#keylog li").eq(0).find(".fa").removeClass("bg-grey").addClass("bg-danger");var str=type_json[action]+"失败("+data.message+")";$("#keylog .panel").eq(0).find(".panel-heading span").html(str)},onComplete:function(data){$("#keylog li").eq(0).find(".ajax_log_new").show(),$("#keylog li").eq(0).find(".log_type").show(),$("#keylog li").eq(0).find(".hide_log").hide(),$("#keylog li").eq(0).find(".log_content").removeClass("log_height2")}})},visitApp:function(port){var port=port?port+".":"",url="http://"+port+this.serviceAlias+"."+this.tenantName+this.wild_domain+this.http_port_str;window.open(url)},manageApp:function(){this.manageUrl&&window.open(this.manageUrl)},updatePayStatus:function(msg){var pay_status=msg.service_pay_status,tips=msg.tips;"no_money"==pay_status?($("#last_hour_fee").html("欠费 关闭"),$(".layer_pay").attr("data-original-title",tips)):"debugging"==pay_status?($("#last_hour_fee").html("调试中"),$(".layer_pay").attr("data-original-title",tips)):"unknown"==pay_status?($("#last_hour_fee").html("0元"),$(".layer_pay").attr("data-original-title",tips)):"wait_for_pay"==pay_status?($("#last_hour_fee").html("等待支付"),$(".layer_pay").attr("data-original-title",tips),this.needPay=msg.need_pay_money,this.payStartTime=msg.start_time_str):"soon"==pay_status?($("#last_hour_fee").html("即将计费"),$(".layer_pay").attr("data-original-title",tips)):"show_money"==pay_status?($("#last_hour_fee").html(msg.cost_money+"元"),$(".layer_pay").attr("data-original-title",tips)):($("#last_hour_fee").html("-"),$(".layer_pay").attr("data-original-title",tips))},getAndRenderEventLog:function(eventId,type){return(0,_appApiCenter.getEventlogByType)(this.tenantName,this.serviceAlias,eventId,type||"info").done(function(data){$(".log_"+eventId).html("");for(var dataObj=data,html=[],newLog=dataObj.data||[],i=0;i<newLog.length;i++){var time=newLog[i].time.split(".")[0],time2=(time.split("T")[0],time.split("T")[1].split("Z")[0]),time3=time2.split("+")[0],log="<p class='clearfix'><span class='log_time'>"+time3+"</span><span class='log_msg'> "+newLog[i].message+"</span></p>";html.unshift(log)}$(".log_"+eventId).prepend(html.join(""))})},getMoreLog:function(num){_getMoreLog(this.tenantName,this.serviceAlias,num).done(function(msg){var dataObj=msg||{},logList=dataObj.log||[],next_onOff=dataObj.has_next;if($(".load_more_new").attr("data-num",parseInt(num)+logList.length),next_onOff?$(".load_more_new").show():$(".load_more_new").hide(),logList&&logList.length){var html=createLogListTmp(logList);$(html).appendTo($("#keylog ul"))}})},renderContainer:function(){(0,_appApiCenter.getAppContainer)(this.tenantName,this.serviceAlias).done(function(dataObj){var msg="",tindex=1;for(var key in dataObj)"split"!=key&&(msg+="<li>",msg+="<a class='app-container-node' data-cid='"+key+"' data-hip='"+dataObj[key]+"' href='javascript:void(0);'> 节点"+tindex+"</a></li>",tindex+=1);""!=msg&&$("#cur_container_content").html(msg)})},visitContainerNode:function(c_id,h_ip){var self=this,adPopup=window.open("about:blank");(0,_appApiCenter.createAppContainerSocket)(this.tenantName,this.serviceAlias,c_id,h_ip).done(function(){adPopup.location.href="/apps/"+self.tenantName+"/"+self.serviceAlias+"/docker/"}).fail(function(){adPopup.close()})},showPayConfirm:function(){var self=this,confirm=_widget2.default.create("confirm",{title:"付费确认",content:$("#payDialogTmp").html(),height:"auto",event:{onOk:function(){(0,_appApiCenter.appPay)(self.tenantName,self.serviceAlias).done(function(data){confirm.destroy(),self.needPay=0,self.payStartTime=""})}}}),$ele=confirm.getElement();$ele.find("#need_to_pay").html(this.needPay),$ele.find("#start_time").html(this.payStartTime)}},domEvents:{".app-container-node click":function(e){var $target=$(e.target),c_id=$target.data("cid"),h_ip=$target.data("hip");c_id&&h_ip&&this.visitContainerNode(c_id,h_ip)},"#join_container click":function(e){this.renderContainer()},"#service_image_operate click":function(e){this.isDoing||this.updateApp()},".manageApp click":function(e){this.manageApp()},".visit-domain click":function(e){var $target=$(e.currentTarget),domain=$target.attr("data-domain");domain&&window.open(domain)},".visit-btn click":function(e){var port=$(e.target).data("port")||"";this.visitApp(port)},"#service_visitor click":function(e){var port=$(e.target).data("port")||"";this.visitApp(port)},"#onekey_deploy click":function(e){this.isDoing||this.deployApp()},"#service_status_close click":function(e){this.isDoing||this.closeApp()},"#service_status_open click":function(e){this.isDoing||this.openApp()},"#onekey_reboot click":function(e){this.isDoing||this.NewrebootApp()},".callback_version click":function(e){var self=this;if(!this.isDoing)var $target=$(e.target),version=$target.data("version"),confirm=_widget2.default.create("confirm",{title:"版本回滚",content:"确定恢复当前版本吗？",event:{onOk:function(){self.rollbackApp(version),confirm.destroy(),confirm=null}}})},".ajax_log_new click":function(e){var $target=$(e.target),event_id=$target.attr("data-log");$target.parents("li").find(".log_type label").removeClass("active"),$target.parents("li").find(".log_type label").eq(0).addClass("active"),"none"!=$target.parents("li").find(".log_type").css("display")&&($(".log_"+event_id).html(""),this.getAndRenderEventLog(event_id,"info")),$target.hide(),$target.parent().find(".hide_log").show(),$target.parents("li").find(".log").addClass("log_height"),$target.parents("li").find(".log_content").addClass("log_height2")},".hide_log click":function(e){var $target=$(e.target);$target.parents(".panel").find(".log").hasClass("log_height")?($target.parents("li").find(".log").removeClass("log_height"),$target.parents("li").find(".ajax_log_new").show(),$target.hide(),$target.parents(".panel").find(".log").css({height:"0px"})):($target.parents("li").find(".log").addClass("log_height"),$target.parents("li").find(".ajax_log_new").hide(),$target.show())},".log-tab-btn click":function(e){var $target=$(e.target);if(!$target.hasClass("active")){var $btns=$target.parent().find(".log-tab-btn"),eventId=$target.parents(".js-event-row").data("event-id"),type=$target.data("log");eventId&&type&&($btns.removeClass("active"),$target.addClass("active"),this.getAndRenderEventLog(eventId,type))}},".layer_pay click":function(e){this.needPay&&this.showPayConfirm()},".sure_pay click":function(e){var self=this;(0,_appApiCenter.appPay)(self.tenantName,self.serviceAlias)},".load_more_new click":function(e){var $target=$(e.currentTarget),num=$target.attr("data-num");num&&this.getMoreLog(num)}},onReady:function(){this.renderData.tenantName=this.tenantName,this.renderData.serviceAlias=this.serviceAlias,this.getInitData()}}),exports.default=AppOverviewController},205:function(module,exports){module.exports='    <link href="http://cdn.bootcss.com/prettify/r224/prettify.css" rel="stylesheet">\n    <link rel="stylesheet" href=\'/static/www-new/src/libs/datetimepicker.css\'>\n    <script type="text/javascript" src="/static/www-new/src/libs/moment.js"><\/script>\n    <script type="text/javascript" src="/static/www-new/src/libs/datetimepicker.js"><\/script>\n    \x3c!-- 01 --\x3e\n    <div class="flex-box" id="status_areas">\n        <div class="flex-singe">\n            <div class="chunkbox" style="height: 220px;">\n                <div class="hd">状态</div>\n                <div class="bd">\n                    <img style="margin-top:30px;margin-bottom:15px;" id="service_status-img" src="/static/www/img/appOutline/appOutline1.png"/>\n                    <div name="service_status">\n                        <span  id="service_status" class="sub-tit-text">未知</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="flex-singe">\n            <div class="chunkbox app_requesttime_thunk" style="height: 220px;">\n                <div class="hd">响应时间</div>\n                <div class="installed-new-plugin" style="display: none;">\n                    <div name="app_requesttime" class="bd">\n                        <span class="tit-text">\n                            <span class="bg-text app_requesttime">0</span>\n                            <span class="text-sub">ms</span>\n                        </span>\n                    </div>\n                    <div class="ft" id="MemoryCost">\n                        <a href="/apps/{{tenantName}}/{{serviceAlias}}/detail/?fr=statistic&type=history" class="link">性能分析</a>\n                    </div>\n                </div>\n                <div class="uninstall-new-plugin">\n                    <div class="tips">\n                        <p>尚未安装性能分析插件</p>\n                        <a href="/apps/{{tenantName}}/{{serviceAlias}}/detail/?fr=plugin">去安装</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="flex-singe" id="DiskBox">\n            <div class="chunkbox app_request_chunk" style="height: 220px;">\n                <div class="hd">吞吐率</div>\n                <div class="installed-new-plugin" style="display: none;">\n                    <div class="bd">\n                        <span  name="" class="tit-text">\n                            <span class="bg-text app_request">0</span>\n                            <span class="text-sub">dps</span>\n                        </span>\n                    </div>\n                    <div class="ft">\n                        <a href="/apps/{{tenantName}}/{{serviceAlias}}/detail/?fr=expansion" class="link">应用伸缩</a></p>\n                    </div>\n                </div>\n                <div class="uninstall-new-plugin">\n                    <div class="tips">\n                        <p>尚未安装性能分析插件</p>\n                        <a href="/apps/{{tenantName}}/{{serviceAlias}}/detail/?fr=plugin">去安装</a>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="flex-singe">\n            <div class="chunkbox" style="height: 220px;">\n                <div class="hd">功能扩展</div>\n                <div class="bd" id="plugin-list-wrap">\n                    \n                </div>\n            </div>\n        </div>\n        <div class="flex-singe">\n            <div class="chunkbox" style="height: 220px;">\n                <div class="hd">资源</div>\n                <div style="margin-top:35px;" class="bd">\n                    <div class="tit-text">\n                        <div>\n                            <span class="bg-text show_memory">{{pageData.totalMemory}}</span>\n                            <span class="text-sub">M 内存</span>\n                        </div>\n                        <div>\n                            <span class="show_disk">{{pageData.last_hour_disk || 0}}</span>\n                            <span class="text-sub">M 磁盘</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \x3c!-- 01 --\x3e\n    \x3c!-- 02 --\x3e\n    <section class="clearfix" style="min-height: 54px;">\n        \x3c!-- 02 left --\x3e\n        <div class="pull-left">\n            <ul class="clearfix handle-box-left">\n                \x3c!--  left-001  --\x3e\n                {{if pageData.hasHttpServices}}\n                <li>\n                    <div class="btn-group fn-tips" action="visit" data-toggle="tooltip" data-placement="top" title="跳转到应用对外访问端口对应的域名地址">\n                        {{if pageData.domain_list.length > 0}}\n                            {{if pageData.domain_list.length == 1}}\n                                <button data-domain="{{pageData.domain_list[0]}}" type="button" class="btn btn-success dropdown-toggle visit-domain" data-toggle="dropdown">访问</button>\n                            {{else}}\n                                 <button type="button" class="btn btn-success" data-toggle="dropdown">访问<span class="caret"></span></button>\n                                    <ul class="dropdown-menu" role="menu">\n                                    {{each pageData.domain_list}}\n                                        <li class="visit-domain"  data-domain={{$value}}><a href="javascript:void(0)">{{$value}}</a></li>\n                                    {{/each}}\n                                    </ul>\n                            {{/if}}\n\n                        {{else}}\n                            {{if pageData.visit_port_type == "multi_outer" }}\n                                {{if pageData.http_outer_service_ports.length == 1}}\n                                    {{each pageData.http_outer_service_ports}}\n                                    <button class="btn btn-success" data-port="{{ $value.container_port }}" type="button" data-toggle="dropdown" id="service_visitor">访问</button>\n                                    {{/each}}\n                                {{else}}\n                                <button type="button" class="btn btn-success" data-toggle="dropdown">访问<span class="caret"></span></button>\n                                <ul class="dropdown-menu" role="menu">\n                                    {{each pageData.http_outer_service_ports}}\n                                        <li><a class="visit-btn" data-port="{{ $value.container_port }}" href="javascript:void(0)">{{ $value.container_port }}端口</a></li>\n                                    {{/each}}\n                                 {{/if}}\n                            {{else}}\n                                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" id="service_visitor">访问</button>\n                            {{/if}}\n                        {{/if}}\n                    </div>\n                </li>\n                {{/if}}\n                \x3c!--  left-001  --\x3e\n                \x3c!--  left-002  --\x3e\n                <li>\n                    {{if appInfo.service.service_type == \'mysql\'}}\n                        {{if pageData.service_manager.deployed}}\n                            {{if pageData.actions[\'manage_service\']}}\n                                <button type="button" class="btn btn-success manageApp">管理\n                                </button>\n                            {{/if}}\n                        {{else}}\n                            {{if pageData.actions[\'manage_service\']}}\n                                <button type="button" class="btn btn-success manageApp">添加管理服务\n                                </button>\n                            {{/if}}\n                        {{/if}}\n                    {{/if}}\n                    {{if pageData.updateService}}\n                        <button type="button" class="btn btn-success" id="service_image_operate">\n                            服务更新\n                        </button>\n                    {{/if}}\n                </li>\n            </ul>\n        </div>\n        \x3c!-- 02 left --\x3e\n        \x3c!-- 02 right --\x3e\n        <div class="pull-right">\n            <ul class="clearfix handle-box-right">\n                {{if pageData.docker_console}}\n                <li action="manage_container">\n                    <div class="btn-group fn-tips" data-toggle="tooltip" data-placement="top" title="选择实例进入WEB控制台，可以进行容器内部shell管理操作。">\n                        <button type="button" name="join_container" class="btn btn-success dropdown-toggle" data-toggle="dropdown"  id="join_container"> 管理容器 <span class="caret"></span></button>\n                        <ul class="dropdown-menu dropdown-menu-right" role="menu" id="cur_container_content">\n                            \n                        </ul>\n                    </div>\n                </li>\n                {{/if}}\n                \x3c!-- right-002 --\x3e\n                \x3c!-- right-003 --\x3e\n                {{if pageData.actions[\'manage_service\']}}\n                <li class="button">\n                    <input type="hidden" id="service_status_value" name="service_status_value" value="" />\n                    <button action="stop" style="display:none;" type="button" class="btn btn-danger" id="service_status_close"><font id="font{{appInfo.service.service_id}}">关闭</font></button>\n                    <button action="restart"style="display:none;" type="button" class="btn btn-success" id="service_status_open"><font id="font{{appInfo.service.service_id}}">开启</font></button>\n                </li>\n                {{/if}}\n                \x3c!-- right-003 --\x3e\n                \x3c!-- right-004 --\x3e\n               \n                    \n                    {{if pageData.actions[\'code_deploy\']}}\n                    <li class="button">\n                        <button action="deploy" type="button" class="btn btn-success fn-tips" id="onekey_deploy" data-toggle="tooltip" data-placement="top" title="基于最新代码或镜像构建云帮应用，并滚动更新实例。">重新部署</button>\n                    </li>\n                    {{/if}}\n               \n                \x3c!-- right-004 --\x3e\n                \x3c!--  --\x3e\n                {{if pageData.actions[\'code_deploy\']}}\n                <li class="button">\n                    <button action="reboot" type="button" style="display:none;" class="btn btn-success fn-tips" id="onekey_reboot" data-toggle="tooltip" data-placement="top" title="关闭应用并使用最新的配置重新启动应用。">重启</button>\n                </li>\n                {{/if}}\n                \x3c!-- --\x3e\n            </ul>\n        </div>\n        \x3c!-- 02 right --\x3e\n    </section>\n    \x3c!-- log start --\x3e\n    <section class="panel panel-default time-line-panel">\n        <div class="panel-heading">\n            <div class="time-selector">\n                <div class="input-group">\n                  <input type="text" class="form-control"  id="datetimepicker" placeholder="查看某个时间点以前的记录">\n                </div>\n            </div>\n            操作记录\n        </div>\n        <div class="panel-body">\n            \n            <input type="hidden" name="service_name" id="service_name" value="{{appInfo.service.service_alias}}"/>\n            <div id="keylog">\n                \n                <ul class="timeline list-unstyled">\n                </ul>\n                <p style="text-align: center;">\n                    <span data-num="0" class="load_more_new" style="display:none;">\n                        <img src="/static/www/img/load_more_log.png">\n                    </span>\n                </p>\n            </div>\n        </div>\n    </section>\n    \x3c!-- log end --\x3e\n    \x3c!-- deployed end--\x3e\n    <script type="text/template" id="payDialogTmp">\n        <div style="text-align: left;">\n        <p>将从您的账户中扣除<span class="text-success" id="need_to_pay"></span>元，用于购买当前应用的包月项目，其余费用仍按小时结算。</p>\n        <p>当前应用将于<span class="text-success" id="start_time"></span>开始计费，逾期未成功支付，应用所有项目将会按需支付。</p>\n        </div>\n    <\/script>\n   '},516:function(module,exports,__webpack_require__){"use strict";function noop(){}function LogSocket(option){option=option||{},this.url=option.url,this.eventId=option.eventId,this.onOpen=option.onOpen||noop,this.onMessage=option.onMessage||noop,this.onError=option.onError||noop,this.onClose=option.onClose||noop,this.onError=option.onError||noop,this.onSuccess=option.onSuccess||noop,this.onComplete=option.onComplete||noop,this.onFail=option.onFail||noop,this.webSocket=new WebSocket(this.url),this.webSocket.onopen=this._onOpen.bind(this),this.webSocket.onmessage=this._onMessage.bind(this),this.webSocket.onclose=this._onClose.bind(this),this.webSocket.onerror=this._onError.bind(this),this.timerQueue=new _timerQueue2.default({onExecute:this.onMessage})}Object.defineProperty(exports,"__esModule",{value:!0});var _timerQueue=__webpack_require__(60),_timerQueue2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_timerQueue);LogSocket.prototype={constructor:LogSocket,getSocket:function(){return this.webSocket},close:function(){this.webSocket.close()},_onOpen:function(evt){this.webSocket.send("event_id="+this.eventId),this.onOpen()},_onMessage:function(evt){if("ok"===evt.data);else{var data=JSON.parse(evt.data);this.timerQueue.add(data),"callback"!=data.step&&"last"!=data.step||(this.webSocket.close(),"success"===data.status?this.onSuccess(data):this.onFail(data),this.onComplete(data))}},_onClose:function(evt){this.onClose()},_onError:function(){this.onError()}},exports.default=LogSocket},517:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var actionCNMap={deploy:"部署",restart:"启动",delete:"删除",stop:"关闭",HorizontalUpgrade:"水平升级",VerticalUpgrade:"垂直升级",callback:"回滚",create:"创建",own_money:"应用欠费关闭",expired:"应用过期关闭","share-ys":"分享到云市","share-yb":"分享到云帮",reboot:"应用重启","git-change":"仓库地址修改",imageUpgrade:"应用更新"},appActionLogUtil={getActionCN:function(log){return actionCNMap[log.type]},getActionStatusInfo:function(log){var status,bgColor,status_json={success:"完成",failure:"失败",timeout:"超时",abnormal:"异常"},final_status_json={complate:"完成",timeout:"超时"},bg_color={success:"bg-success",failure:"bg-danger",timeout:"bg-danger",abnormal:"bg-yellow"};return"complete"==log.final_status?(status=status_json[log.status],bgColor=bg_color[log.status]):"timeout"==log.final_status?(status=final_status_json[log.final_status],bgColor="bg-danger"):(status="进行中",bgColor="bg-grey"),{text:status,bgColor:bgColor}},getActionUser:function(log){return log.user_name||""},isFail:function(log){return"failure"===log.status},isComplete:function(log){return"complete"===log.final_status},getFailMessage:function(log){},getCommitUser:function(log){return log.code_version?log.code_version.user:""},getCodeVersion:function(log){return log.code_version?log.code_version.code_version:""},getCommitLog:function(log){return log.code_version?log.code_version.commit:""},isDeploy:function(log){return"deploy"===log.type},canRollback:function(log){return this.isDeploy(log)&&log.code_version&&log.code_version.rollback},getRollbackVersion:function(log){return log.deploy_version},getActionTime:function(log){return log.start_time||""}};exports.default=appActionLogUtil},518:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var dateUtil={format:function(date,_format){var date=new Date(date),map={yyyy:function(){return date.getFullYear()},MM:function(){var val=date.getMonth()+1;return val<10?"0"+val:val},dd:function(){var val=date.getDate();return val<10?"0"+val:val},hh:function(){var val=date.getHours();return val<10?"0"+val:val},mm:function(){var val=date.getMinutes();return val<10?"0"+val:val},ss:function(){var val=date.getSeconds();return val<10?"0"+val:val}};for(var k in map)_format=_format.replace(k,map[k]);return _format},dateToCN:function(date,format){function isToday(str){var d=new Date(str),todaysDate=new Date;return d.setHours(0,0,0,0)==todaysDate.setHours(0,0,0,0)}function isYestday(date){var d=new Date(date),date=new Date,today=new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime(),yestday=new Date(today-864e5).getTime();return d.getTime()<today&&yestday<=d.getTime()}function isBeforeYestday(date){var d=new Date(date),date=new Date,today=new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime(),yestday=new Date(today-864e5).getTime(),beforeYestday=new Date(today-1728e5).getTime();return d.getTime()<yestday&&beforeYestday<=d.getTime()}return function(date){return isToday(date)?"今天":isYestday(date)?"昨天":isBeforeYestday(date)?"前天":dateUtil.format(date,format)}(date)}};exports.default=dateUtil},533:function(module,exports,__webpack_require__){module.exports=__webpack_require__(188)},59:function(module,exports,__webpack_require__){"use strict";function Queue(){this.datas=[]}Object.defineProperty(exports,"__esModule",{value:!0}),Queue.prototype={constructor:Queue,push:function(data){void 0!==data&&this.datas.push(data)},shift:function(){return this.datas.shift()},getCount:function(){return this.datas.length},empty:function(){return 0===this.datas.length}},exports.default=Queue},60:function(module,exports,__webpack_require__){"use strict";function TimerQueue(option){option=option||{},this.queue=new _queue2.default,this.timer=null,this.isStarted=!1,this.interval=option.interval||300,this.onExecute=option.onExecute||util.noop}Object.defineProperty(exports,"__esModule",{value:!0});var _queue=__webpack_require__(59),_queue2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_queue);TimerQueue.prototype={add:function(data){this.queue.push(data),this.isStarted||this.start()},start:function(){var self=this;this.timer=setInterval(function(){self.queue.empty()?self.stop():self.execute()},this.interval)},stop:function(){this.isStarted=!1,clearInterval(this.timer)},execute:function(){this.onExecute(this.queue.shift())}},exports.default=TimerQueue}},[533]);